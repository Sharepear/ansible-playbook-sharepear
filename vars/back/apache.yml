---

apache_repository: false

apache_site_enable:
  - "api.{{ inventory_hostname }}"

apache_vhosts:
  - servername: "api.{{ inventory_hostname }}"
    index: index.php
    documentroot: /var/www/api.{{ inventory_hostname }}/current/web
    logDir: /var/www/api.{{ inventory_hostname }}/current/app/logs
    extra:
      - "ServerName api.{{ inventory_hostname }}"
    directory_extra:
      - "RewriteEngine On"
      - "RewriteCond %{REQUEST_URI}::$1 ^(/.+)/(.*)::\\2$"
      - "RewriteRule ^(.*) - [E=BASE:%1]"
      - "RewriteCond %{ENV:REDIRECT_STATUS} ^$"
      - "RewriteRule ^app\\.php(/(.*)|$) %{ENV:BASE}/$2 [R=301,L]"
      - "RewriteCond %{REQUEST_FILENAME} -f"
      - "RewriteRule .? - [L]"
      - "RewriteRule .? %{ENV:BASE}/app.php [L]"
